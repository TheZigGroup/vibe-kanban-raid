{
  "db_name": "SQLite",
  "query": "SELECT\n                t.id as \"task_id!: Uuid\",\n                t.project_id as \"task_project_id!: Uuid\",\n                t.title as \"task_title!\",\n                t.description as \"task_description\",\n                t.status as \"task_status!: TaskStatus\",\n                t.parent_workspace_id as \"task_parent_workspace_id: Uuid\",\n                t.source as \"task_source!: TaskSource\",\n                t.layer as \"task_layer: TaskLayer\",\n                t.task_type as \"task_task_type: TaskType\",\n                t.sequence as \"task_sequence: i32\",\n                t.testing_criteria as \"task_testing_criteria\",\n                t.created_at as \"task_created_at!: DateTime<Utc>\",\n                t.updated_at as \"task_updated_at!: DateTime<Utc>\",\n                w.id as \"workspace_id!: Uuid\",\n                w.task_id as \"workspace_task_id!: Uuid\",\n                w.container_ref as \"workspace_container_ref\",\n                w.branch as \"workspace_branch!\",\n                w.agent_working_dir as \"workspace_agent_working_dir\",\n                w.setup_completed_at as \"workspace_setup_completed_at: DateTime<Utc>\",\n                w.created_at as \"workspace_created_at!: DateTime<Utc>\",\n                w.updated_at as \"workspace_updated_at!: DateTime<Utc>\",\n                w.archived as \"workspace_archived!: bool\",\n                w.pinned as \"workspace_pinned!: bool\",\n                w.name as \"workspace_name\"\n            FROM tasks t\n            JOIN workspaces w ON w.task_id = t.id\n            WHERE t.project_id = $1\n              AND t.status = 'inreview'\n              AND w.archived = 0\n              -- Has at least one completed execution process (codingagent)\n              AND EXISTS (\n                  SELECT 1\n                  FROM sessions s\n                  JOIN execution_processes ep ON ep.session_id = s.id\n                  WHERE s.workspace_id = w.id\n                    AND ep.run_reason = 'codingagent'\n                    AND ep.status IN ('completed', 'failed', 'killed')\n              )\n              -- No running execution processes\n              AND NOT EXISTS (\n                  SELECT 1\n                  FROM sessions s\n                  JOIN execution_processes ep ON ep.session_id = s.id\n                  WHERE s.workspace_id = w.id\n                    AND ep.status = 'running'\n              )\n            ORDER BY t.created_at ASC\n            LIMIT 1",
  "describe": {
    "columns": [
      {
        "name": "task_id!: Uuid",
        "ordinal": 0,
        "type_info": "Blob"
      },
      {
        "name": "task_project_id!: Uuid",
        "ordinal": 1,
        "type_info": "Blob"
      },
      {
        "name": "task_title!",
        "ordinal": 2,
        "type_info": "Text"
      },
      {
        "name": "task_description",
        "ordinal": 3,
        "type_info": "Text"
      },
      {
        "name": "task_status!: TaskStatus",
        "ordinal": 4,
        "type_info": "Text"
      },
      {
        "name": "task_parent_workspace_id: Uuid",
        "ordinal": 5,
        "type_info": "Blob"
      },
      {
        "name": "task_source!: TaskSource",
        "ordinal": 6,
        "type_info": "Text"
      },
      {
        "name": "task_layer: TaskLayer",
        "ordinal": 7,
        "type_info": "Text"
      },
      {
        "name": "task_task_type: TaskType",
        "ordinal": 8,
        "type_info": "Text"
      },
      {
        "name": "task_sequence: i32",
        "ordinal": 9,
        "type_info": "Integer"
      },
      {
        "name": "task_testing_criteria",
        "ordinal": 10,
        "type_info": "Text"
      },
      {
        "name": "task_created_at!: DateTime<Utc>",
        "ordinal": 11,
        "type_info": "Text"
      },
      {
        "name": "task_updated_at!: DateTime<Utc>",
        "ordinal": 12,
        "type_info": "Text"
      },
      {
        "name": "workspace_id!: Uuid",
        "ordinal": 13,
        "type_info": "Blob"
      },
      {
        "name": "workspace_task_id!: Uuid",
        "ordinal": 14,
        "type_info": "Blob"
      },
      {
        "name": "workspace_container_ref",
        "ordinal": 15,
        "type_info": "Text"
      },
      {
        "name": "workspace_branch!",
        "ordinal": 16,
        "type_info": "Text"
      },
      {
        "name": "workspace_agent_working_dir",
        "ordinal": 17,
        "type_info": "Text"
      },
      {
        "name": "workspace_setup_completed_at: DateTime<Utc>",
        "ordinal": 18,
        "type_info": "Datetime"
      },
      {
        "name": "workspace_created_at!: DateTime<Utc>",
        "ordinal": 19,
        "type_info": "Text"
      },
      {
        "name": "workspace_updated_at!: DateTime<Utc>",
        "ordinal": 20,
        "type_info": "Text"
      },
      {
        "name": "workspace_archived!: bool",
        "ordinal": 21,
        "type_info": "Integer"
      },
      {
        "name": "workspace_pinned!: bool",
        "ordinal": 22,
        "type_info": "Integer"
      },
      {
        "name": "workspace_name",
        "ordinal": 23,
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Right": 1
    },
    "nullable": [
      true,
      false,
      false,
      true,
      false,
      true,
      true,
      true,
      true,
      true,
      true,
      false,
      false,
      true,
      false,
      true,
      false,
      true,
      true,
      false,
      false,
      false,
      false,
      true
    ]
  },
  "hash": "4780316a2fe09ef5e1a2d053907c5e10f471a7b8dba8b92d4c0388d68a631e66"
}
